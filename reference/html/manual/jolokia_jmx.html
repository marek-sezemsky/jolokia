<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JMX Support :: Jolokia</title>
    <link rel="canonical" href="https://jolokia.org/manual/jolokia_jmx.html">
    <link rel="prev" href="clients.html">
    <link rel="next" href="spring.html">
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../_/css/site.css">
    <link rel="stylesheet" href="../_/css/jolokia.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://jolokia.org">Jolokia</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="manual" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="index.html">Jolokia Manual</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="extensions.html">Extending Jolokia</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="agents.html">Agents</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="proxy_mode.html">Proxy Mode</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="jolokia_protocol.html">Jolokia Protocol</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="jolokia_mbeans.html">Jolokia MBeans</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="clients.html">Clients</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="jolokia_jmx.html">JMX Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="spring.html">Spring Support</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Jolokia Manual</span>
    <span class="version"></span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="index.html">Jolokia Manual</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Jolokia Manual</a></li>
    <li><a href="jolokia_jmx.html">JMX Support</a></li>
  </ul>
</nav>
<div class="edit-this-page"><a href="https://github.com/jolokia/jolokia/tree/main/src/documentation/manual/modules/ROOT/pages/jolokia_jmx.adoc">Help improving this page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">JMX Support</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The main focus of Jolokia is to allow easy access to JMX MBeans
from everywhere. MBeans can be provided by the JVM itself, by an
application server or an application itself, where each MBean is
registered at a specific MBeanServer. Multiple MBeanServers can
co-exist in a single JVM. The so called
<em>PlatformMBeanServer</em> is always present and is
created by the JVM during startup. Especially application servers
often create additional MBeanServers for various purposes. When
accessing an MBean remotely via JSR-160, the MBeanServer holding
the requested MBean must be known before. Jolokia instead
<em>merges</em> all MBeanServers it can find to give a
single view on all MBeans. The merging algorithm is described in
<a href="#mbeanserver-merging">MBeanServer merging</a>.</p>
</div>
<div class="paragraph">
<p>For application specific MBeans, Jolokia provides an own, so
called <em>Jolokia MBeanServer</em> which is treated
specially by the Jolokia agent. The Jolokia MBeanServer and its
features are explained in <a href="#jolokia-mbeanserver">Jolokia MBeanServer</a>.</p>
</div>
<div class="paragraph">
<p>Developing application specific MBeans is easy, especially if
<a href="http://docs.oracle.com/javase/tutorial/jmx/mbeans/standard.html" class="externalLink" target="_blank" rel="noopener">Standard MBeans</a> are used. However, for Spring users there is even a
easier, more
<a href="https://docs.spring.io/spring-framework/reference/integration/jmx/exporting.html" class="externalLink" target="_blank" rel="noopener">declarative way</a> for turning POJOs into MBeans. On top of this Jolokia
provides an easy, declarative way for firing up a Jolokia JVM
agent merely by including some Jolokia specific Spring
configuration. This is described in <a href="spring.html" class="xref page">Spring Support</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jolokia-mbeanserver"><a class="anchor" href="#jolokia-mbeanserver"></a>Jolokia MBeanServer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Jolokia MBeanServer can be easily created and used with a locator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">MBeanServer jolokiaServer = JolokiaMBeanServerUtil.getJolokiaMBeanServer();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Internally, <code>javax.management.MBeanServerFactory.newMBeanServer()</code> is called, so it&#8217;s not returned when
calling <code>javax.management.MBeanServerFactory.findMBeanServer()</code>.</p>
</div>
<div class="paragraph">
<p>This server is treated specially by a Jolokia Agent:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Every MBean registered at the Jolokia MBeanServer will never
show up remotely via JSR-160. The Jolokia MBeanServer is never
exposed over JSR-160.</p>
</li>
<li>
<p>Each Jolokia MBeanServer registered MBean will shadow any
MBean with the same ObjectName in any other MBeanServer
present. See below for more details.</p>
</li>
<li>
<p>The Jolokia MBeanServer is also responsible for managing so
called <em>JSON MBeans</em>. These are MBeans
annotated with <code>@JsonMBean</code> on the class
level. JSON MBean are explained in
<a href="#json-mbean">@JsonMBean</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="mbeanserver-merging"><a class="anchor" href="#mbeanserver-merging"></a>MBeanServer merging</h3>
<div class="paragraph">
<p>Jolokia tries hard to detect as many MBeanServer as available
in a JVM. Beside the always present
<code>PlatformMBeanServer</code> many
application servers create own MBeanServer which not always
can be found with standard mechanisms. Therefore Jolokia comes
with so called <code>ServerDetector</code>s for many
known brands of applications server. These server detectors
know how to find MBeanServer by application server specific
means.</p>
</div>
<div class="paragraph">
<p>The set of available of MBeanServers is detected during
startup and kept, except for the Jolokia MBeanServer which can
kick in and out at any time. For Jolokia operations, all these
MBeanServers are tried according the order given below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Jolokia <code>MBeanServer</code></strong> is queried first,
if available.</p>
</li>
<li>
<p>Next every <code>MBeanServer</code> as detected by the <em>server
detectors</em> a queried in turn.</p>
</li>
<li>
<p>All MBeanServers returned by
<code>MBeanServerFactory.findMBeanServer(null)</code> (which should return all the <code>MBeanServers</code> created with
<code>MBeanServerFactory.createMBeanServer()</code>, but not the ones created by <code>javax.management.MBeanServerFactory.newMBeanServer()</code>) are
called if not already tried previously.</p>
</li>
<li>
<p>Finally, the
<code>ManagementFactory.getPlatformMBeanServer()</code> is
used (also, if not found in a former step).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All MBeans contained in all detected MBeanServers are merged
to give a single view on the set of available MBeans.
For MBeans registered with the same name at different
MBeanServers, MBeans registered in later MBeanServers are not
visible. These hidden MBeans will never be called on
<code>read</code>, <code>write</code> or
<code>exec</code> operations. Also, for
<code>list</code> operations only the meta data of the
visible MBeans is returned.</p>
</div>
<div class="paragraph">
<p>This hiding mechanism is used by
<code>@JsonMBean</code> to provide a different view of
an MBean for JSR-160 connectors (see below).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="json-mbean"><a class="anchor" href="#json-mbean"></a>@JsonMBean</h2>
<div class="sectionbody">
<div class="paragraph">
<p>JMX 1.4 introduced
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.management/javax/management/MXBean.html" class="externalLink" target="<em>blank">MXBeans</a>
which allow for nearly arbitrary data to be translated into so
called _OpenData</em> which are accessible via JMX. For example,
arbitrary Java Beans are translated into a
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.management/javax/management/openmbean/CompositeData.html" class="externalLink" target="_blank" rel="noopener"><code>CompositeData</code></a>
structure with property names as keys and their values in
OpenData values.</p>
</div>
<div class="paragraph">
<p>Jolokia provides an annotation <code>@JsonMBean</code>
for marking an MBean as a JSON MBean. Such an MBean, if
registered at the <em>Jolokia MBeanServer</em>
creates a proxy on the <em>PlatformMBeanServer</em>
where every complex value gets translated into plain strings in
JSON format. This is true for attributes, operation return
values and arguments. That way, a JSR-160 based console (like
<code>jconsole</code>) can easily access complex data
type exposed by custom MBeans. Json MBeans work for Java 6 and
newer.</p>
</div>
<div id="fig-jconsole-json-mbean" class="imageblock">
<div class="content">
<img src="_images/jconsole-json-mbean.png" alt="jconsole json mbean">
</div>
<div class="title">Figure 1. A JsonMBean in jconsole</div>
</div>
<div class="paragraph">
<p>JsonMBean and MXBean are quite similar as both do a translation
from complex data types to a standard format (OpenType for
MXBeans, JSON strings for JsonMBean). However, there are also
differences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MXBeans are a standard mechanism which are available on every
JVM since 1.5<sup class="footnote" id="_footnote_jboss-mxbean">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>.</p>
</li>
<li>
<p>Serialization of complex Java Beans is more powerful with
JsonMBeans, e.g. Jolokia can detect self (or cyclic) object
references. MXBeans will cause an error in this case.</p>
</li>
<li>
<p>JsonMBeans must be added to the Jolokia MBeanServer to
work. MXBeans work with the PlatformMBeanServer, too.</p>
</li>
<li>
<p>JsonMBean work also with JMX support libraries which use
<code>ModelMBean</code>'s under the hood. E.g.
<a href="https://docs.spring.io/spring-framework/reference/integration/jmx.html" class="externalLink" target="_blank" rel="noopener">Spring JMX</a> uses a ModelMBean for
<code>@ManagedResource</code> annotated
MBeans. <code>@JsonMBean</code> can be easily added,
whereas <code>@MXBean</code> wouldn&#8217;t work here.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Jolokia MBeanServer and the
<code>@JsonMBean</code> annotation are contained in the
Maven module <code>jolokia-support-jmx</code>.</p>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. For JBoss prior to version 7 there are some slight issues since JBoss used to replace the standard MBeanServer with an own variant. See this <a href="https://community.jboss.org/thread/167796">discussion</a> for details.
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="clients.html">Clients</a></span>
  <span class="next"><a href="spring.html">Spring Support</a></span>
</nav>
</article>
  </div>
<footer class="footer">
  This page was built using the Antora default UI. The source code for this UI is licensed under the terms of the MPL-2.0 license. | Copyright © 2010 -
  2023 Roland Huß
</footer>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async src="../_/js/vendor/highlight.js"></script>
</main>
</div>
  </body>
</html>
